polyverse/config/vfi: |
  {
    "etcd": {
      "type": "dockerImage",
      "address": "quay.io/coreos/etcd:v3.0.12"
    },
    "nsq": {
      "type": "dockerImage",
      "address": "nsqio/nsq:v0.3.8"
    },
    "supervisor": {
      "type": "dockerImage",
      "address": "polyverse/supervisor:5070011dd2a34265121a960005e73a5a9fc3f914"
    },
    "router": {
      "type": "dockerImage",
      "address": "polyverse/router:5453e8c9b2b7264b725f97297a078f4d47bfa71e"
    },
    "containerManager": {
      "type": "dockerImage",
      "address": "polyverse/container-manager:64be36fd2ebe6091250603d937139991aa909538"
    }
  }
polyverse/config/docker/config_json: |
  {
    "auths": {
      "https://index.docker.io/v1/": {
        "auth": "cHZyZWFkb25seTpnd2JLcjd4Vm5CRzlZeQ=="
      }
    }
  }
polyverse/config/monitoring/docker_log_driver: "json-file"
polyverse/config/monitoring/log_source_line: "true"
polyverse/config/monitoring/log_container_changes: "true"
polyverse/config/monitoring/log_metrics: "false"
polyverse/config/monitoring/statsd_endpoint: "127.0.0.1:8125"
polyverse/config/monitoring/statter_cluster_name: "chris_test_cluster"
apps/website: |
  app = function() {

    return {
      Name: function() {
        return "polysploit";
      },
      IsRequestSupported: function(r, c) {
        return true ;
      },
      Route: function(r, c) {
        if ((r.Method === "POST") && (r.Form["ID"] === undefined)) {
          return null;
        }

        var id = ((r.Method === "POST") && (r.Form["ID"] != undefined) && (r.Form["ID"][0] != undefined)) ? r.Form["ID"][0] : "default";

        var baseImage = ((r.Method === "POST") && (r.Form["BaseImage"] != undefined) && (r.Form["BaseImage"][0] != undefined)) ? r.Form["BaseImage"][0] : "polyverse/polysploit";

        if ((r.Method === "POST") && (r.Form["PerInstanceTimeout"] != undefined) && (r.Form["PerInstanceTimeout"][0] != undefined)) {
          var perInstanceTimeout = Number(r.Form["PerInstanceTimeout"][0]);
        } else {
          var perInstanceTimeout = 10000000000;
        }

        var desiredInstances = ((r.Method === "POST") && (r.Form["DesiredInstances"] != undefined) && (r.Form["DesiredInstances"][0] != undefined)) ? Number(r.Form["DesiredInstances"][0]) : 3;

        if ((r.Method === "POST") && (r.Form["IsStateless"] != undefined) && (r.Form["IsStateless"][0] != undefined)) {
          var isStateless = /^true$/i.test(r.Form["IsStateless"][0]);
        } else {
          var isStateless = true;
        }

        c.Log.Infof("X-Polysploit: ID = %s, PerInstanceTimeout = %v, DesiredInstances = %v, IsStateless = %v", id, perInstanceTimeout, desiredInstances, isStateless);

        return {
          ID: id,
          Timeout: 365 * 24 * 60 * 60 * 1000000000,
          ManagedContainer: {
            BaseImage: baseImage,
            PerInstanceTimeout: perInstanceTimeout,
            DesiredInstances: desiredInstances,
            IsStateless: isStateless,
            HealthCheckURLPath: "/",
            LaunchGracePeriod: 60 * 1000000000,
            ConnectionDrainGracePeriod: 3 * 1000000000,
            Cmd: [''],
            BindingPort: 8080
          }
        };
      },
      ValidationInfo: function() {
        return {
          PositiveRequests: [],
          NegativeRequests: []
        }
      }
    };
  }();
