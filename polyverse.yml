polyverse/config/vfi: |
  {
    "etcd": {
      "type": "dockerImage",
      "address": "quay.io/coreos/etcd:v3.0.12"
    },
    "nsq": {
      "type": "dockerImage",
      "address": "nsqio/nsq:v0.3.8"
    },
    "supervisor": {
      "type": "dockerImage",
      "address": "polyverse/supervisor:3e11e266c5d0c7aeed32f826da53eaece5f9411f"
    },
    "router": {
      "type": "dockerImage",
      "address": "polyverse/router:99b61de3d4a2aca291105e2caedbfe5bcc6f7f29"
    },
    "containerManager": {
      "type": "dockerImage",
      "address": "polyverse/container-manager:9c279e40a4482a1d62cb7aa7f567538dad46e2d7"
    }
  }
polyverse/config/docker/config_json: |
  {
    "auths": {
      "https://index.docker.io/v1/": {
        "auth": "cHZyZWFkb25seTpnd2JLcjd4Vm5CRzlZeQ=="
      }
    }
  }
polyverse/config/monitoring/docker_log_driver: "json-file"
polyverse/config/monitoring/log_source_line: "true"
polyverse/config/monitoring/log_container_changes: "true"
polyverse/config/monitoring/log_metrics: "false"
polyverse/config/monitoring/statsd_endpoint: "127.0.0.1:8125"
polyverse/config/monitoring/statter_cluster_name: "chris_test_cluster"
polyverse-apps/website: |
  app = function() {

    return {
      Name: function() {
        return "polysploit";
      },
      IsRequestSupported: function(r, c) {
        return true ;
      },
      Route: function(r, c) {
        var id = "default";
        var perInstanceTimeout = 5000000000;
        var desiredInstances = 5;
        var isStateless = true;

        if (r.Method === "POST") {
          if (r.Form["ID"] === undefined) {
            c.Log.Info("X-Polysploit: Method is POST but ID is undefined. Returning null.");
            return null;
          }
        
          if ((r.Form["ID"] != undefined) && (r.Form["ID"][0] != undefined)) {
            id = r.Form["ID"][0];
            c.Log.Infof("Setting ID to: %s", id);
          }

          if ((r.Form["PerInstanceTimeout"] != undefined) && (r.Form["PerInstanceTimeout"][0] != undefined)) {
            perInstanceTimeout = Number(r.Form["PerInstanceTimeout"][0]);
            c.Log.Infof("Setting PerInstanceTimeout to: %v", perInstanceTimeout);
          }

          if ((r.Form["DesiredInstances"] != undefined) && (r.Form["DesiredInstances"][0] != undefined)) {
            desiredInstances = Number(r.Form["DesiredInstances"][0]);
            c.Log.Infof("Setting DesiredInstances to: %v", desiredInstances);
          }

          if ((r.Form["IsStateless"] != undefined) && (r.Form["IsStateless"][0] != undefined)) {
            isStateless = Boolean(r.Form["IsStateless"]);
            c.Log.Infof("Setting isStateless to: %v", isStateless);
          }

          c.Log.Infof("X-Polysploit: ID = %s, PerInstanceTimeout = %v, DesiredInstances = %v, IsStateless = %v", id, perInstanceTimeout, desiredInstances, isStateless);
        }

        return {
          ID: id,
          Timeout: 365 * 24 * 60 * 60 * 1000000000,
          ManagedContainer: {
            BaseImage: "polyverse/polysploit",
            PerInstanceTimeout: perInstanceTimeout,
            DesiredInstances: desiredInstances,
            IsStateless: isStateless,
            HealthCheckURLPath: "/",
            LaunchGracePeriod: 60 * 1000000000,
            ConnectionDrainGracePeriod: 3 * 1000000000,
            Cmd: [''],
            BindingPort: 8080
          }
        };
      },
      ValidationInfo: function() {
        return {
          PositiveRequests: [],
          NegativeRequests: []
        }
      }
    };
  }();
