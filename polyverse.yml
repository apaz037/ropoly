polyverse/config/vfi: | # From: pv vfi get Runtime:v0.17.0-rc2
  {
    "etcd": {
      "type": "dockerImage",
      "address": "quay.io/coreos/etcd:v3.0.12"
    },
    "nsq": {
      "type": "dockerImage",
      "address": "nsqio/nsq:v0.3.8"
    },
    "supervisor": {
      "type": "dockerImage",
      "address": "polyverse/supervisor:8181674177f0c9e57056517c426374a104bc580a"
    },
    "router": {
      "type": "dockerImage",
      "address": "polyverse/router:5d448da3b3be7c7829edadb9b1764e6f1608cd9b"
    },
    "containerManager": {
      "type": "dockerImage",
      "address": "polyverse/container-manager:79f0479f4a1dab6d8e842e1188bb91dfcbd9d6c9"
    }
  }
polyverse/config/docker/config_json: |
  {
    "auths": {
      "https://index.docker.io/v1/": {
        "auth": "cnN1bmRhaGw6eEMyLXpNVi1uN2EtS3pT"
      },
      "polyverse-runtime.jfrog.io": {
        "auth": "cm95OkFLQ3AyVm9hcXBhNER5a055UThYZFZEbUNXWmdjazdHODZGNHR0NWtvcU1KRzdKQmpqVlhBazl4VzNBSzVXV25nUEFyeGs0ZWk="
        },
      "polyverse-tools.jfrog.io": {
        "auth": "cm95OkFLQ3AyVm9hcXBhNER5a055UThYZFZEbUNXWmdjazdHODZGNHR0NWtvcU1KRzdKQmpqVlhBazl4VzNBSzVXV25nUEFyeGs0ZWk="
      }
    }
  }
polyverse/config/monitoring/docker_log_driver: "json-file"
polyverse/config/monitoring/log_source_line: "true"
polyverse/config/monitoring/log_container_changes: "true"
polyverse/config/monitoring/log_metrics: "false"
polyverse/config/monitoring/statsd_endpoint: "127.0.0.1:8125"
polyverse/config/monitoring/statter_cluster_name: "chris_test_cluster"
apps/website: |
  app = function() {

    return {
      Name: function() {
        return "polysploit";
      },
      IsRequestSupported: function(r, c) {
        return true ;
      },
      Route: function(r, c) {
        if ((r.Method === "POST") && (r.Form["ID"] === undefined)) {
          return null;
        }

        var id = ((r.Method === "POST") && (r.Form["ID"] != undefined) && (r.Form["ID"][0] != undefined)) ? r.Form["ID"][0] : "default";

        var baseImage = ((r.Method === "POST") && (r.Form["BaseImage"] != undefined) && (r.Form["BaseImage"][0] != undefined)) ? r.Form["BaseImage"][0] : "polysploit";

        if ((r.Method === "POST") && (r.Form["PerInstanceTimeout"] != undefined) && (r.Form["PerInstanceTimeout"][0] != undefined)) {
          var perInstanceTimeout = Number(r.Form["PerInstanceTimeout"][0]);
        } else {
          var perInstanceTimeout = 10000000000;
        }

        var desiredInstances = ((r.Method === "POST") && (r.Form["DesiredInstances"] != undefined) && (r.Form["DesiredInstances"][0] != undefined)) ? Number(r.Form["DesiredInstances"][0]) : 3;

        if ((r.Method === "POST") && (r.Form["IsStateless"] != undefined) && (r.Form["IsStateless"][0] != undefined)) {
          var isStateless = /^true$/i.test(r.Form["IsStateless"][0]);
        } else {
          var isStateless = true;
        }

        c.Log.Infof("X-Polysploit: ID = %s, PerInstanceTimeout = %v, DesiredInstances = %v, IsStateless = %v", id, perInstanceTimeout, desiredInstances, isStateless);

        return {
          ID: id,
          Timeout: 365 * 24 * 60 * 60 * 1000000000,
          ManagedContainer: {
            BaseImage: baseImage,
            PerInstanceTimeout: perInstanceTimeout,
            DesiredInstances: desiredInstances,
            IsStateless: isStateless,
            HealthCheckURLPath: "/",
            LaunchGracePeriod: 60 * 1000000000,
            ConnectionDrainGracePeriod: 3 * 1000000000,
            Cmd: [''],
            BindingPort: 8080
          }
        };
      },
      ValidationInfo: function() {
        return {
          PositiveRequests: [],
          NegativeRequests: []
        }
      }
    };
  }();
